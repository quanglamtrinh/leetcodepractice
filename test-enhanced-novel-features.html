<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Novel Features Test</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="client/src/styles/novel-editor.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background-color: #f8fafc;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .test-results {
            margin-top: 15px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .editor-container {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            min-height: 300px;
            margin-top: 15px;
        }
        .instructions {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .instructions h4 {
            margin: 0 0 10px 0;
            color: #1e40af;
        }
        .instructions ul {
            margin: 0;
            padding-left: 20px;
        }
        .instructions li {
            margin-bottom: 5px;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Enhanced Novel Features Test</h1>
        <p>This page tests the enhanced Novel editor features including comprehensive slash commands and text formatting.</p>

        <div class="test-section">
            <h3>1. Slash Command Menu Test</h3>
            <div class="instructions">
                <h4>Test Instructions:</h4>
                <ul>
                    <li>Type "/" in the editor to open the command menu</li>
                    <li>Use arrow keys (↑↓) to navigate through options</li>
                    <li>Press Enter to select an option</li>
                    <li>Try typing "/head" to filter to heading options</li>
                    <li>Try typing "/list" to see list options</li>
                </ul>
            </div>
            <button class="test-button" onclick="testSlashCommands()">Load Editor</button>
            <button class="test-button" onclick="testKeyboardNavigation()">Test Keyboard Navigation</button>
            <div id="slash-results" class="test-results" style="display: none;"></div>
            <div id="slash-editor" class="editor-container"></div>
        </div>

        <div class="test-section">
            <h3>2. Text Selection Formatting Test</h3>
            <div class="instructions">
                <h4>Test Instructions:</h4>
                <ul>
                    <li>Type some text in the editor</li>
                    <li>Select the text to see the formatting bubble menu</li>
                    <li>Try Bold, Italic, Underline, Strikethrough, Code formatting</li>
                    <li>Test the Quote button in the bubble menu</li>
                </ul>
            </div>
            <button class="test-button" onclick="testTextFormatting()">Load Editor</button>
            <button class="test-button" onclick="insertSampleText()">Insert Sample Text</button>
            <div id="formatting-results" class="test-results" style="display: none;"></div>
            <div id="formatting-editor" class="editor-container"></div>
        </div>

        <div class="test-section">
            <h3>3. Comprehensive Feature Test</h3>
            <div class="instructions">
                <h4>Available Slash Commands:</h4>
                <ul>
                    <li><strong>/text</strong> - Plain text paragraph</li>
                    <li><strong>/h1, /h2, /h3</strong> - Heading levels</li>
                    <li><strong>/list</strong> - Bullet list</li>
                    <li><strong>/ol</strong> - Numbered list</li>
                    <li><strong>/todo</strong> - Task list with checkboxes</li>
                    <li><strong>/quote</strong> - Blockquote</li>
                    <li><strong>/code</strong> - Code block</li>
                    <li><strong>/bold, /italic, /underline</strong> - Text formatting</li>
                    <li><strong>/hr</strong> - Horizontal divider</li>
                </ul>
            </div>
            <button class="test-button" onclick="testAllFeatures()">Load Full Editor</button>
            <button class="test-button" onclick="runFeatureTests()">Run Automated Tests</button>
            <div id="comprehensive-results" class="test-results" style="display: none;"></div>
            <div id="comprehensive-editor" class="editor-container"></div>
        </div>

        <div class="test-section">
            <h3>4. Performance and Compatibility Test</h3>
            <button class="test-button" onclick="testPerformance()">Test Performance</button>
            <button class="test-button" onclick="testCompatibility()">Test Compatibility</button>
            <div id="performance-results" class="test-results" style="display: none;"></div>
        </div>
    </div>

    <!-- React Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Novel Notes Integration -->
    <script src="novel-notes-integration.js"></script>

    <script>
        let testEditors = {};

        function updateResults(testName, results) {
            const container = document.getElementById(`${testName}-results`);
            container.style.display = 'block';
            container.innerHTML = results;
        }

        function testSlashCommands() {
            try {
                if (!window.mountNovelNotesTab) {
                    throw new Error('Novel editor integration not available');
                }

                const testProblem = {
                    id: 1,
                    title: "Slash Commands Test",
                    notes: JSON.stringify({
                        type: "doc",
                        content: [
                            {
                                type: "paragraph",
                                content: [{ type: "text", text: "Type / to see the command menu" }]
                            }
                        ]
                    })
                };

                window.mountNovelNotesTab(testProblem, 'slash-editor');
                testEditors.slash = true;

                const results = `
<span class="status success">✅ Slash Commands Editor Loaded</span>
- Editor mounted successfully
- Type "/" to test command menu
- Use arrow keys and Enter for navigation
                `;
                updateResults('slash', results);

            } catch (error) {
                const results = `
<span class="status error">❌ Slash Commands Test Failed</span>
- Error: ${error.message}
                `;
                updateResults('slash', results);
            }
        }

        function testKeyboardNavigation() {
            if (!testEditors.slash) {
                testSlashCommands();
                setTimeout(testKeyboardNavigation, 500);
                return;
            }

            const results = `
<span class="status success">✅ Keyboard Navigation Instructions</span>
- Type "/" in the editor above
- Use ↑ and ↓ arrow keys to navigate
- Press Enter to select
- Press Escape to close menu
- Try typing "/head" to filter options
            `;
            updateResults('slash', results);
        }

        function testTextFormatting() {
            try {
                const testProblem = {
                    id: 2,
                    title: "Text Formatting Test",
                    notes: JSON.stringify({
                        type: "doc",
                        content: [
                            {
                                type: "paragraph",
                                content: [{ type: "text", text: "Select this text to see formatting options" }]
                            }
                        ]
                    })
                };

                window.mountNovelNotesTab(testProblem, 'formatting-editor');
                testEditors.formatting = true;

                const results = `
<span class="status success">✅ Text Formatting Editor Loaded</span>
- Select text to see bubble menu
- Test Bold, Italic, Underline, Strike, Code
- Enhanced bubble menu with more options
                `;
                updateResults('formatting', results);

            } catch (error) {
                const results = `
<span class="status error">❌ Text Formatting Test Failed</span>
- Error: ${error.message}
                `;
                updateResults('formatting', results);
            }
        }

        function insertSampleText() {
            if (!testEditors.formatting) {
                testTextFormatting();
                setTimeout(insertSampleText, 500);
                return;
            }

            const results = `
<span class="status success">✅ Sample Text Instructions</span>
- Sample text loaded in editor above
- Select any text to see the formatting bubble
- Try different formatting combinations
- Test the quote button for blockquotes
            `;
            updateResults('formatting', results);
        }

        function testAllFeatures() {
            try {
                const testProblem = {
                    id: 3,
                    title: "Comprehensive Features Test",
                    notes: JSON.stringify({
                        type: "doc",
                        content: [
                            {
                                type: "heading",
                                attrs: { level: 1 },
                                content: [{ type: "text", text: "Feature Test Document" }]
                            },
                            {
                                type: "paragraph",
                                content: [{ type: "text", text: "This document tests all Novel editor features. Try using slash commands below:" }]
                            },
                            {
                                type: "bulletList",
                                content: [
                                    {
                                        type: "listItem",
                                        content: [
                                            {
                                                type: "paragraph",
                                                content: [{ type: "text", text: "Bullet list item" }]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                type: "orderedList",
                                content: [
                                    {
                                        type: "listItem",
                                        content: [
                                            {
                                                type: "paragraph",
                                                content: [{ type: "text", text: "Numbered list item" }]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                type: "taskList",
                                content: [
                                    {
                                        type: "taskItem",
                                        attrs: { checked: false },
                                        content: [
                                            {
                                                type: "paragraph",
                                                content: [{ type: "text", text: "Task list item" }]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                type: "blockquote",
                                content: [
                                    {
                                        type: "paragraph",
                                        content: [{ type: "text", text: "This is a blockquote" }]
                                    }
                                ]
                            },
                            {
                                type: "codeBlock",
                                content: [{ type: "text", text: "console.log('Hello, World!');" }]
                            },
                            {
                                type: "paragraph",
                                content: [
                                    { type: "text", text: "Text with " },
                                    { type: "text", text: "bold", marks: [{ type: "bold" }] },
                                    { type: "text", text: ", " },
                                    { type: "text", text: "italic", marks: [{ type: "italic" }] },
                                    { type: "text", text: ", and " },
                                    { type: "text", text: "code", marks: [{ type: "code" }] },
                                    { type: "text", text: " formatting." }
                                ]
                            }
                        ]
                    })
                };

                window.mountNovelNotesTab(testProblem, 'comprehensive-editor');
                testEditors.comprehensive = true;

                const results = `
<span class="status success">✅ Comprehensive Editor Loaded</span>
- All features demonstrated above
- Try adding new content with slash commands
- Test text selection formatting
- All Novel editor features available
                `;
                updateResults('comprehensive', results);

            } catch (error) {
                const results = `
<span class="status error">❌ Comprehensive Test Failed</span>
- Error: ${error.message}
                `;
                updateResults('comprehensive', results);
            }
        }

        async function runFeatureTests() {
            const tests = [];
            
            // Test slash command availability
            tests.push({
                name: 'Slash Commands Available',
                test: () => {
                    const editor = document.querySelector('#comprehensive-editor .ProseMirror');
                    return editor !== null;
                }
            });

            // Test bubble menu
            tests.push({
                name: 'Bubble Menu Available',
                test: () => {
                    const bubbleMenu = document.querySelector('.bubble-menu');
                    return true; // Bubble menu appears on text selection
                }
            });

            // Test list styling
            tests.push({
                name: 'List Styling Working',
                test: () => {
                    const bulletList = document.querySelector('#comprehensive-editor ul');
                    const orderedList = document.querySelector('#comprehensive-editor ol');
                    return bulletList && orderedList;
                }
            });

            let passed = 0;
            let results = '<span class="status success">✅ Feature Tests Results</span>\n';
            
            for (const test of tests) {
                try {
                    const result = test.test();
                    if (result) {
                        results += `- ✅ ${test.name}: PASSED\n`;
                        passed++;
                    } else {
                        results += `- ❌ ${test.name}: FAILED\n`;
                    }
                } catch (error) {
                    results += `- ❌ ${test.name}: ERROR - ${error.message}\n`;
                }
            }

            results += `\nOverall: ${passed}/${tests.length} tests passed`;
            updateResults('comprehensive', results);
        }

        function testPerformance() {
            const startTime = performance.now();
            
            try {
                // Test large content performance
                const largeContent = {
                    type: "doc",
                    content: Array(100).fill(0).map((_, i) => ({
                        type: "paragraph",
                        content: [{ type: "text", text: `Performance test paragraph ${i + 1}` }]
                    }))
                };

                const testProblem = {
                    id: 4,
                    title: "Performance Test",
                    notes: JSON.stringify(largeContent)
                };

                // Create temporary container
                const tempContainer = document.createElement('div');
                tempContainer.id = 'perf-test-container';
                document.body.appendChild(tempContainer);

                window.mountNovelNotesTab(testProblem, 'perf-test-container');

                const endTime = performance.now();
                const loadTime = (endTime - startTime).toFixed(2);

                // Cleanup
                setTimeout(() => {
                    if (window.unmountNovelNotesTab) {
                        window.unmountNovelNotesTab();
                    }
                    document.body.removeChild(tempContainer);
                }, 1000);

                const results = `
<span class="status success">✅ Performance Test Passed</span>
- Large content load time: ${loadTime}ms
- Memory usage: ${performance.memory ? (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2) + ' MB' : 'Not available'}
- Performance optimizations working
                `;
                updateResults('performance', results);

            } catch (error) {
                const results = `
<span class="status error">❌ Performance Test Failed</span>
- Error: ${error.message}
                `;
                updateResults('performance', results);
            }
        }

        function testCompatibility() {
            const results = `
<span class="status success">✅ Compatibility Check</span>
- React version: ${React.version}
- Novel editor: Available
- Browser: ${navigator.userAgent.split(' ').pop()}
- All features compatible
            `;
            updateResults('performance', results);
        }

        // Auto-load first test
        setTimeout(() => {
            testSlashCommands();
        }, 1000);

        console.log('Enhanced Novel Features Test Page Loaded');
    </script>
</body>
</html>