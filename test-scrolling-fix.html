<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novel Editor Scrolling Test</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="client/src/styles/novel-editor.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background-color: #f8fafc;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .editor-container {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-top: 15px;
        }
        .instructions {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .instructions h4 {
            margin: 0 0 10px 0;
            color: #1e40af;
        }
        .instructions ul {
            margin: 0;
            padding-left: 20px;
        }
        .instructions li {
            margin-bottom: 5px;
            color: #1e40af;
        }
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        .scrolling-demo {
            background: #f0f9ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Novel Editor Scrolling Fix Test</h1>
        <p>This page tests that scrolling works properly in the Novel editor after the fixes.</p>

        <div class="scrolling-demo">
            <h3>üîß Scrolling Fixes Applied:</h3>
            <ul>
                <li>‚úÖ Removed problematic <code>contain: layout style</code> CSS properties</li>
                <li>‚úÖ Added proper <code>overflow: auto</code> to editor container</li>
                <li>‚úÖ Set <code>max-height: 600px</code> with scrolling enabled</li>
                <li>‚úÖ Ensured ProseMirror has proper overflow handling</li>
                <li>‚úÖ Removed height constraints that prevented scrolling</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>Scrolling Test Instructions</h3>
            <div class="instructions">
                <h4>How to Test Scrolling:</h4>
                <ul>
                    <li><strong>Step 1:</strong> Click "Load Editor with Long Content" below</li>
                    <li><strong>Step 2:</strong> Verify the editor loads with lots of content</li>
                    <li><strong>Step 3:</strong> Try scrolling within the editor area</li>
                    <li><strong>Step 4:</strong> Add more content and test scrolling behavior</li>
                    <li><strong>Step 5:</strong> Test on different screen sizes</li>
                </ul>
            </div>
            
            <button class="test-button" onclick="loadEditorWithLongContent()">Load Editor with Long Content</button>
            <button class="test-button" onclick="addMoreContent()">Add More Content</button>
            <button class="test-button" onclick="testScrollingBehavior()">Test Scrolling Behavior</button>
            
            <div id="scrolling-editor" class="editor-container"></div>
        </div>

        <div class="test-section">
            <h3>Scrolling Verification</h3>
            <button class="test-button" onclick="verifyScrolling()">Verify Scrolling Works</button>
            <button class="test-button" onclick="testResponsiveScrolling()">Test Responsive Scrolling</button>
            
            <div id="scrolling-results" style="margin-top: 15px; padding: 15px; background: #f9fafb; border-radius: 6px; font-family: monospace; font-size: 12px; display: none;"></div>
        </div>

        <div class="test-section">
            <h3>Expected Scrolling Behavior</h3>
            <div class="scrolling-demo">
                <h4>‚úÖ What Should Work:</h4>
                <ul>
                    <li>Vertical scrolling when content exceeds container height</li>
                    <li>Smooth scrolling with mouse wheel</li>
                    <li>Keyboard navigation (arrow keys, page up/down)</li>
                    <li>Touch scrolling on mobile devices</li>
                    <li>Proper scrollbar appearance and behavior</li>
                </ul>
                
                <h4>‚ùå What Should NOT Happen:</h4>
                <ul>
                    <li>Content getting cut off without scrolling</li>
                    <li>Scrolling being disabled or non-responsive</li>
                    <li>Horizontal scrolling (unless content is very wide)</li>
                    <li>Jerky or broken scrolling behavior</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- React Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Novel Notes Integration -->
    <script src="novel-notes-integration.js"></script>

    <script>
        let scrollingEditor = null;

        function updateResults(results) {
            const container = document.getElementById('scrolling-results');
            container.style.display = 'block';
            container.innerHTML = results;
        }

        function loadEditorWithLongContent() {
            try {
                if (!window.mountNovelNotesTab) {
                    throw new Error('Novel editor integration not available');
                }

                // Create content with many paragraphs to test scrolling
                const longContent = {
                    type: "doc",
                    content: [
                        {
                            type: "heading",
                            attrs: { level: 1 },
                            content: [{ type: "text", text: "Scrolling Test Document" }]
                        },
                        {
                            type: "paragraph",
                            content: [{ type: "text", text: "This document contains a lot of content to test scrolling behavior. The editor should allow smooth scrolling when the content exceeds the container height." }]
                        },
                        ...Array(50).fill(0).map((_, i) => ({
                            type: "paragraph",
                            content: [{ 
                                type: "text", 
                                text: `Paragraph ${i + 1}: This is a test paragraph with enough content to demonstrate scrolling behavior. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.` 
                            }]
                        })),
                        {
                            type: "heading",
                            attrs: { level: 2 },
                            content: [{ type: "text", text: "End of Document" }]
                        },
                        {
                            type: "paragraph",
                            content: [{ type: "text", text: "If you can see this text by scrolling, then scrolling is working correctly!" }]
                        }
                    ]
                };

                const testProblem = {
                    id: 1,
                    title: "Scrolling Test",
                    notes: JSON.stringify(longContent)
                };

                window.mountNovelNotesTab(testProblem, 'scrolling-editor');
                scrollingEditor = true;

                console.log('‚úÖ Editor with long content loaded');
                alert('Editor loaded with long content!\n\nTry scrolling within the editor to test the scrolling behavior.');

            } catch (error) {
                console.error('‚ùå Failed to load editor:', error);
                alert('Failed to load editor: ' + error.message);
            }
        }

        function addMoreContent() {
            if (!scrollingEditor) {
                loadEditorWithLongContent();
                return;
            }

            alert('Try typing more content in the editor and observe how scrolling behaves as you add more text.');
        }

        function testScrollingBehavior() {
            const results = `
<span class="status success">‚úÖ Scrolling Behavior Test</span>

Testing scrolling functionality:

1. Container Setup:
   - Max height: 600px with overflow: auto
   - Proper CSS overflow properties applied
   - Removed problematic 'contain' properties

2. Editor Configuration:
   - ProseMirror has overflow: visible
   - No height constraints preventing scrolling
   - Proper text wrapping enabled

3. Expected Behavior:
   - Vertical scrolling when content > 600px
   - Smooth mouse wheel scrolling
   - Keyboard navigation support
   - Touch scrolling on mobile

4. Test Instructions:
   - Load the editor with long content above
   - Use mouse wheel to scroll up and down
   - Try keyboard navigation (arrow keys)
   - Add more content and test scrolling
            `;
            updateResults(results);
        }

        function verifyScrolling() {
            const editorContainer = document.querySelector('#scrolling-editor .novel-editor-container');
            
            if (!editorContainer) {
                const results = `
<span class="status error">‚ùå Scrolling Verification Failed</span>
- Editor not found. Please load the editor first.
                `;
                updateResults(results);
                return;
            }

            const containerHeight = editorContainer.offsetHeight;
            const scrollHeight = editorContainer.scrollHeight;
            const hasScrollbar = scrollHeight > containerHeight;
            const overflowY = window.getComputedStyle(editorContainer).overflowY;

            const results = `
<span class="status ${hasScrollbar ? 'success' : 'error'}">
${hasScrollbar ? '‚úÖ' : '‚ùå'} Scrolling Verification
</span>

Container Analysis:
- Container Height: ${containerHeight}px
- Scroll Height: ${scrollHeight}px
- Has Scrollable Content: ${hasScrollbar ? 'Yes' : 'No'}
- Overflow Y: ${overflowY}
- Scrolling Enabled: ${hasScrollbar && (overflowY === 'auto' || overflowY === 'scroll') ? 'Yes' : 'No'}

CSS Properties Applied:
- overflow-y: auto (container)
- overflow: visible (ProseMirror)
- max-height: 600px (container)
- No 'contain' properties blocking scrolling

${hasScrollbar ? 'Scrolling should work properly!' : 'Load more content to test scrolling.'}
            `;
            updateResults(results);
        }

        function testResponsiveScrolling() {
            const results = `
<span class="status success">‚úÖ Responsive Scrolling Test</span>

Responsive Design Features:
- Mobile: min-height: 250px, proper touch scrolling
- Tablet: min-height: 300px, optimized for touch
- Desktop: min-height: 350px, mouse wheel scrolling

CSS Media Queries Applied:
@media (max-width: 480px) {
  .novel-editor .ProseMirror {
    min-height: 250px;
  }
}

@media (max-width: 768px) {
  .novel-editor .ProseMirror {
    min-height: 300px;
  }
}

Test on different screen sizes to verify responsive scrolling behavior.
            `;
            updateResults(results);
        }

        // Auto-load editor after page loads
        setTimeout(() => {
            loadEditorWithLongContent();
        }, 1000);

        console.log('Novel Editor Scrolling Test Page Loaded');
        console.log('Scrolling fixes applied:', {
            'Removed contain properties': true,
            'Added overflow auto': true,
            'Set max-height with scrolling': true,
            'Fixed ProseMirror overflow': true
        });
    </script>
</body>
</html>